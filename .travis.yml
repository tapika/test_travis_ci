language: cpp

matrix:
  include:
  - os: linux
    dist: bionic
  - os: windows

git:
  clone: false

cache:
    directories:
    - /c/dev1/cppreflect/out

script:
    # Fail on first failure
    - set -e
    - if [ "$TRAVIS_OS_NAME" = "windows" ]; 
      then 
        mkdir -p /c/dev1 ;
        cd /c/dev1 ;
      else 
        sudo mkdir -p /c/dev1 ;
        sudo chown -R $USER:$USER /c/dev1 ;
        cd /c/dev1 ;
      fi
    - git clone https://github.com/$TRAVIS_REPO_SLUG.git test_travis_ci && cd test_travis_ci
    - if [ "$TRAVIS_OS_NAME" = "windows" ]; then 
        export PATH="/c/Python27:/c/Python27/Scripts:$PATH";
        choco install python2; 
      fi
    - pwd
    - mv ../cppreflect/out ../cppreflect_out
    - rmdir ../cppreflect
    - python build.py -phase 1
    - mv ../cppreflect_out ../cppreflect/out
    - python build.py -phase 2

notifications:
  email: false
